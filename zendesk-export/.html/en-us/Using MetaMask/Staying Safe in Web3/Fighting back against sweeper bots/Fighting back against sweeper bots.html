<p><span style="font-weight: 400;">Have assets suddenly moved out of your account, without your permission or knowledge? Have you noticed that every time you transfer something into your account, it gets automatically forwarded somewhere else?</span></p>
<p><span style="font-weight: 400;">If so, you might be dealing with a </span><em><span style="font-weight: 400;">sweeper</span></em><span style="font-weight: 400;">. This article will give some explanation as to what sweepers are, how they happen, and further guidance as to how to deal with having one attached to your account.</span></p>
<h3 id="h_01H8Y8R34F9Y4HPCCRCH16CY8F">
<span style="font-weight: 400;">If you don’t have a sweeper on your account, but want to know more about how to avoid ending up in this situation, consult our </span><a href="https://support.metamask.io/hc/en-us/articles/12091923128347" target="_self" rel="undefined">preventative guide</a><span style="font-weight: 400;">.</span>
</h3>
<h4 id="h_01H8Y8R34F5ABD1T8NBWZXTY4X"><span style="font-weight: 400;">What is a sweeper?</span></h4>
<p><span style="font-weight: 400;">Also known as a </span><em><span style="font-weight: 400;">sweeper bot</span></em><span style="font-weight: 400;">, a sweeper is an automated bit of code (also called a </span><em><span style="font-weight: 400;">script</span></em><span style="font-weight: 400;">) that can be assigned to a blockchain address, to perform actions relating to that account automatically, such as automatically </span><em><span style="font-weight: 400;">sweeping</span></em><span style="font-weight: 400;"> assets deposited into the account to another address.</span></p>
<p><span style="font-weight: 400;">Like all computer programs, whether a script is malicious or not depends on who programmed it, what it’s designed to do, and where it is deployed. After all, being able to move assets programmatically from one address to another could be very convenient functionality. However, sweeper bots are often deployed maliciously. </span></p>
<h3 id="h_01H8Y8R34FVQ063130WBKDV4JA"><span style="font-weight: 400;">Most times, a user gives away their Secret Recovery Phrase; a malicious actor uses that access to deploy a script to this account, automatically sending all the wallet’s valuable resources somewhere else.</span></h3>
<h4 id="h_01H8Y8R34FG72F46S2025FASS9"><span style="font-weight: 400;">How does a sweeper work?</span></h4>
<p><span style="font-weight: 400;">In order to understand how sweepers, and other bots that act on public blockchain networks, operate, a little bit of technical understanding as to how these networks work is necessary. At a high level, then: A public blockchain network is composed of any number of </span><em><span style="font-weight: 400;">nodes</span></em><span style="font-weight: 400;">, each of which is communicating with the rest of the network’s nodes, continually maintaining </span><em><span style="font-weight: 400;">consensus</span></em><span style="font-weight: 400;"> regarding the state of a common </span><em><span style="font-weight: 400;">ledger</span></em><span style="font-weight: 400;">. That ledger keeps track of any number of different assets, depending on how the blockchain was designed.</span></p>
<p><span style="font-weight: 400;">Users on the network send </span><em><span style="font-weight: 400;">transactions</span></em><span style="font-weight: 400;"> from their addresses to other addresses. These transactions are </span><em><span style="font-weight: 400;">broadcast</span></em><span style="font-weight: 400;"> to the closest node(s), which then forward the proposed transaction on to the rest of the network. The user’s transaction remains pending for a time, with other recent transactions, in what’s known as the </span><em><span style="font-weight: 400;">transaction pool </span></em><span style="font-weight: 400;">(txpool) or </span><em><span style="font-weight: 400;">memory pool</span></em><span style="font-weight: 400;"> (mempool). Meanwhile, the nodes do the work of checking that the address requesting the transfer, in fact, has the funds available for transfer, and reach consensus with the rest of the network that the transaction is thus valid. At this point, a group of validated transactions is grouped together and encrypted, and proposed to the network as a </span><em><span style="font-weight: 400;">block</span></em><span style="font-weight: 400;"> of transactions; when it is accepted, it is included in the </span><em><span style="font-weight: 400;">chain</span></em><span style="font-weight: 400;">.</span></p>
<h3 id="h_01H8Y8R34F1YGKV9DQDYGHHBF5">
<span style="font-weight: 400;">If blockchain terminology or concepts trip you up, don’t worry. Check out </span><a href="https://consensys.net/knowledge-base/a-blockchain-glossary-for-beginners/" target="_self" rel="undefined">Consensys’ Blockchain Glossary</a><span style="font-weight: 400;"> and our </span><a href="https://support.metamask.io/hc/en-us/articles/360015489611"><span style="font-weight: 400;">Learn the Basics article</span></a><span style="font-weight: 400;">. </span>
</h3>
<p><span style="font-weight: 400;">Sweeper bots, most often, are scanning that pool of transactions for transfers of tokens to the compromised address; as soon as a bot sees an incoming transfer of value or tokens that would be of interest, it initiates a second transaction, transferring those assets to another, third-party address.</span></p>
<p><span style="font-weight: 400;">Because this is all automated via code and actions are taken almost simultaneously with the funds being transferred to the account, it might happen faster than the time it takes to refresh the block explorer. You certainly won’t be able to manually transfer assets out of your account faster than a bot.</span></p>
<p><span style="font-weight: 400;">Consider some of these details observed about sweeper behavior:</span></p>
<ul>
<li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;">A sweeper might favor the asset that is highest in USD value, even if that means spending more in transaction fees to sweep it.</span></li>
<li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;">The sweeper may use all available ETH to maximize the value swept out of the account, while also having a high likelihood of being the “winning” transaction, in cases where there is a battle between two parties to remove assets from an account</span></li>
<li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;">Even if there is no ETH in the account, an attacker may fund an account temporarily in order to cover the gas fees to extract other desirable assets from the account (NFTs, Liquidity Pool tokens, etc.)</span></li>
<li style="font-weight: 400;" aria-level="1">
<span style="font-weight: 400;">If the USD value of assets in the account is below a certain level, the bot may not sweep out the assets, meaning </span><strong>you may not realize that you have a sweeper on your account</strong><span style="font-weight: 400;">.</span>
</li>
</ul>
<h4 id="h_01H8Y8R34FTJDPZCET17RF170Q"><span style="font-weight: 400;">Bringing a bot to a bot fight</span></h4>
<p><span style="font-weight: 400;">In this context–fighting against an automated opponent who takes your ETH from you before you can use it–things can look pretty hopeless. Enter </span><a href="https://docs.flashbots.net/"><span style="font-weight: 400;">Flashbots</span></a><span style="font-weight: 400;">, who have developed a project called </span><a href="https://github.com/flashbots/searcher-sponsored-tx"><span style="font-weight: 400;">Flashbots/searcher-sponsored-tx</span></a><span style="font-weight: 400;">. This allows you, essentially, to pay for the transaction on the compromised address from another account. Or, as they put it: </span><em><span style="font-weight: 400;">“This is accomplished by submitting a Flashbots transaction bundle, with the first "sponsor" transaction paying the "executor" wallet in ETH, followed by a series of executor transactions that spend this newly received ETH on gas fees.” </span></em></p>
<p><span style="font-weight: 400;">This strategy requires two accounts — the compromised account (the </span><em><span style="font-weight: 400;">executor</span></em><span style="font-weight: 400;">) and another to pay for the transaction (the </span><em><span style="font-weight: 400;">sponsor</span></em><span style="font-weight: 400;">). </span><strong>Success using Flashbots will require significant technical know-how and research. The following instructions are provided as a general guide only.</strong></p>
<ul>
<li style="font-weight: 400;" aria-level="1">
<span style="font-weight: 400;">Make sure the compromised account has no ETH in it; we highly recommend you use a </span><a href="https://twitter.com/smpalladino/status/1373049027365904389?s=20&amp;t=PE8rsffOnw8PxiKzpl7OdQ"><span style="font-weight: 400;">burner bot</span></a><span style="font-weight: 400;"> first.</span>
</li>
<ul>
<li style="font-weight: 400;" aria-level="2">
<span style="font-weight: 400;">We generally advise running this burner bot on more than one machine, using a different endpoint on each. For example, run a burner locally using </span><a href="https://infura.io/"><span style="font-weight: 400;">Infura</span></a><span style="font-weight: 400;">, and a burner on a remote server with another provider such as </span><a href="https://www.quicknode.com/"><span style="font-weight: 400;">Quiknode</span></a><span style="font-weight: 400;">. This is so that you have a redundancy plan in case we have high network latency or node issues (rate limits, syncing issues).</span>
</li>
</ul>
<li style="font-weight: 400;" aria-level="1">
<span style="font-weight: 400;">The code in </span><a href="https://github.com/flashbots/searcher-sponsored-tx"><span style="font-weight: 400;">Flashbots/searcher-sponsored-tx</span></a><span style="font-weight: 400;"> will need to be altered for your specific needs, but the engine is there for you to rescue your tokens from a compromised address. The Flashbots engine is flexible enough to support a single </span><a href="https://eips.ethereum.org/EIPS/eip-20"><span style="font-weight: 400;">transfer()</span></a><span style="font-weight: 400;"> call, or </span><a href="https://eips.ethereum.org/EIPS/eip-900#unstake"><span style="font-weight: 400;">unstake()</span></a><span style="font-weight: 400;"> and </span><a href="https://eips.ethereum.org/EIPS/eip-20"><span style="font-weight: 400;">transfer()</span></a><em><span style="font-weight: 400;">.</span></em>
</li>
</ul>
<h4 id="h_01H8Y8R34GGKNF0XG0VPMJ076E"><span style="font-weight: 400;">Using a self-destructing smart contract</span></h4>
<p><span style="font-weight: 400;">Another method of getting ETH into the account without it being publicly broadcast in the transaction pool is by sending it through an </span><a href="https://support.metamask.io/hc/en-us/articles/360058568312-Internal-transactions"><span style="font-weight: 400;">internal transaction</span></a><span style="font-weight: 400;">, using a smart contract deployed by a new, clean, safe address.</span></p>
<pre><span style="font-weight: 400;">pragma solidity &gt;=0.7.0 &lt;0.9.0;</span><br><br><span style="font-weight: 400;">contract MoveETH {</span><br><span style="font-weight: 400;">    constructor(address sendToAddress) payable {</span><br><span style="font-weight: 400;">        address payable addr = payable(address(sendToAddress));</span><br><span style="font-weight: 400;">        selfdestruct(addr);</span><br><span style="font-weight: 400;">    }</span><br><span style="font-weight: 400;">}</span></pre>
<p><span style="font-weight: 400;">By deploying this contract, we can send ETH and the compromised address string in the constructor argument. This contract works by creating the contract and self-destructing in the same transaction. The use of selfdestruct() means we clear the blockchain state (since it's a one time use contract) and forward the ETH to the compromised address in 1 transaction.</span></p>
<p><span style="font-weight: 400;">Example: </span><a href="https://goerli.etherscan.io/tx/0x82ccb222eae55aaea73dd0efee1ea6ed7320f880889f280d4a343b8823f86692"><span style="font-weight: 400;">https://goerli.etherscan.io/tx/0x82ccb222eae55aaea73dd0efee1ea6ed7320f880889f280d4a343b8823f86692</span></a></p>
<p><span style="font-weight: 400;">While effective, this method uses a notably higher amount of gas (about 70,000), as it is much more complex than a simple transfer from one account to another (normally 22,000).</span></p>
<p><span style="font-weight: 400;">From here, we would broadcast pre-signed transactions ensuring we are using all the ETH in the account so that a sweeper cannot frontrun us - or at least make it unlikely to be frontrun, as a sweeper would need to send more ETH to the account to pay a higher gas price.</span></p>
<h3 id="h_01H8Y8R34GQVKCW04JM2ANV7EM">
<span style="font-weight: 400;">Remember, the best way to beat a sweeper is… to not have to in the first place! Follow </span><span style="font-weight: 400;">our recommendations</span><span style="font-weight: 400;"><a href="https://support.metamask.io/hc/en-us/articles/12091923128347" target="_self"> here</a>, and stay safe out there.</span>
</h3>
<p> </p>
<p><span style="font-weight: 400;">This is an updated version of <a href="https://blog.mycrypto.com/how-to-beat-an-ethereum-based-sweeper-and-recover-your-assets">an article</a> originally published on MyCrypto's blog.</span></p>